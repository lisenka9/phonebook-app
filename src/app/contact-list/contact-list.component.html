<div class="container mt-4">
  <div class="row">
    <div class="col-md-12">
      <h2>–¢–µ–ª–µ—Ñ–æ–Ω–Ω—ã–π —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫</h2>
      <button class="btn btn-primary mb-3" (click)="createNewContact()">
        –î–æ–±–∞–≤–∏—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç
      </button>
    </div>
  </div>

  <div class="row">
    <!-- –°–ø–∏—Å–æ–∫ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ -->
    <div class="col-md-6">
      <div class="card">
        <div class="card-header">
          <h5 class="card-title mb-0">–ö–æ–Ω—Ç–∞–∫—Ç—ã</h5>
        </div>
        <div class="card-body">
          <div *ngIf="loading" class="text-center">
            <div class="spinner-border" role="status">
              <span class="visually-hidden">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
            </div>
          </div>
          
          <div *ngIf="!loading && contacts.length === 0" class="text-center">
            <p>–ö–æ–Ω—Ç–∞–∫—Ç–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</p>
          </div>

          <div class="list-group">
            <a *ngFor="let contact of contacts"
               class="list-group-item list-group-item-action"
               [class.active]="selectedContact?.id === contact.id"
               (click)="selectContact(contact)">
              <div class="d-flex w-100 justify-content-between">
                <h6 class="mb-1">{{ contact.username }}</h6>
              </div>
              <p class="mb-1">{{ contact.email }}</p>
              <small *ngIf="contact.mobile" class="d-block">üì± –ú–æ–±–∏–ª—å–Ω—ã–π: {{ contact.mobile }}</small>
              <small *ngIf="contact.home" class="d-block">üè† –î–æ–º–∞—à–Ω–∏–π: {{ contact.home }}</small>
            </a>
          </div>
        </div>
      </div>
    </div>

    <!-- –§–æ—Ä–º–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è -->
    <div class="col-md-6" *ngIf="selectedContact">
      <div class="card">
        <div class="card-header">
          <h5 class="card-title mb-0">
            {{ selectedContact.id ? '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ' : '–ù–æ–≤—ã–π –∫–æ–Ω—Ç–∞–∫—Ç' }}
          </h5>
        </div>
        <div class="card-body">
          <form (ngSubmit)="saveContact(selectedContact)" #contactForm="ngForm">
            <div class="mb-3">
              <label for="username" class="form-label">–ò–º—è *</label>
              <input type="text" class="form-control" id="username"
                     [(ngModel)]="selectedContact.username"
                     name="username" 
                     required
                     minlength="2"
                     #username="ngModel"
                     [class.is-invalid]="username.invalid && (username.dirty || username.touched)"
                     [class.is-valid]="username.valid && (username.dirty || username.touched)">
              <div *ngIf="username.invalid && (username.dirty || username.touched)" class="invalid-feedback">
                <div *ngIf="username.errors?.['required']">–ò–º—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è</div>
                <div *ngIf="username.errors?.['minlength']">–ò–º—è –¥–æ–ª–∂–Ω–æ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 2 —Å–∏–º–≤–æ–ª–∞</div>
              </div>
            </div>

            <div class="mb-3">
              <label for="email" class="form-label">Email</label>
              <input type="email" class="form-control" id="email"
                    [(ngModel)]="selectedContact.email"
                    name="email" 
                    email
                    #email="ngModel"
                    [class.is-invalid]="email.invalid && (email.dirty || email.touched)"
                    [class.is-valid]="email.valid && (email.dirty || email.touched)">
              <div *ngIf="email.invalid && (email.dirty || email.touched)" class="invalid-feedback">
                <div *ngIf="email.errors?.['email']">–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π email</div>
              </div>
            </div>

            <div class="mb-3">
              <label for="mobile" class="form-label">–ú–æ–±–∏–ª—å–Ω—ã–π —Ç–µ–ª–µ—Ñ–æ–Ω *</label>
              <input type="tel" class="form-control" id="mobile"
                     [(ngModel)]="selectedContact.mobile"
                     name="mobile"
                     required
                     pattern="^[\+]?[0-9\s\-\(\)]+$"
                     #mobile="ngModel"
                     [class.is-invalid]="mobile.invalid && (mobile.dirty || mobile.touched)"
                     [class.is-valid]="mobile.valid && (mobile.dirty || mobile.touched)">
              <div *ngIf="mobile.invalid && (mobile.dirty || mobile.touched)" class="invalid-feedback">
                <div *ngIf="mobile.errors?.['required']">–ú–æ–±–∏–ª—å–Ω—ã–π —Ç–µ–ª–µ—Ñ–æ–Ω –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω</div>
                <div *ngIf="mobile.errors?.['pattern']">–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞</div>
              </div>
            </div>

            <div class="mb-3">
              <label for="home" class="form-label">–î–æ–º–∞—à–Ω–∏–π —Ç–µ–ª–µ—Ñ–æ–Ω</label>
              <input type="tel" class="form-control" id="home"
                     [(ngModel)]="selectedContact.home"
                     name="home"
                     pattern="^[\+]?[0-9\s\-\(\)]+$"
                     #home="ngModel"
                     [class.is-invalid]="home.invalid && (home.dirty || home.touched)"
                     [class.is-valid]="home.valid && (home.dirty || home.touched)">
              <div *ngIf="home.invalid && (home.dirty || home.touched)" class="invalid-feedback">
                <div *ngIf="home.errors?.['pattern']">–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞</div>
              </div>
            </div>

            <div class="d-flex gap-2">
              <button type="submit" class="btn btn-success" 
                      [disabled]="contactForm.invalid">
                {{ selectedContact.id ? '–û–±–Ω–æ–≤–∏—Ç—å' : '–°–æ–∑–¥–∞—Ç—å' }}
              </button>
              <button type="button" class="btn btn-secondary" 
                      (click)="selectedContact = null">
                –û—Ç–º–µ–Ω–∞
              </button>
              <button *ngIf="selectedContact?.id" 
                      type="button" class="btn btn-danger ms-auto"
                      (click)="deleteContact(selectedContact.id!)">
                –£–¥–∞–ª–∏—Ç—å
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>